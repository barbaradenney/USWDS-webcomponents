#!/usr/bin/env sh

# USWDS Integration Validation Pre-commit Hook
#
# This hook prevents commits that contain:
# 1. Direct USWDS imports instead of using the loader utility
# 2. Missing USWDS transformation protections
# 3. Regression issues that could cause combo-box-like problems

echo "ğŸ” Running USWDS integration validation..."

# Run USWDS loader validation
echo "ğŸ“¦ Validating USWDS loader usage..."
npm run validate:uswds-loader
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ COMMIT BLOCKED: USWDS loader validation failed"
  echo "ğŸ’¡ Fix the issues above before committing"
  echo "ğŸ“– See docs/USWDS_TRANSFORMATION_PATTERNS.md for guidance"
  exit 1
fi

# Run USWDS transformation tests (quick)
echo "ğŸ§ª Running USWDS transformation stability tests..."
npm run test:uswds-transformation
if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ COMMIT BLOCKED: USWDS transformation tests failed"
  echo "ğŸ’¡ Component transformation stability issues detected"
  echo "ğŸ”§ This prevents combo-box-like regression issues"
  exit 1
fi

echo "âœ… USWDS integration validation passed"
exit 0